
name: Connectify - Front

on:

  push:
    branches: [ "dev_test" ]

  workflow_dispatch:

permissions:
  id-token: write # Require write permission to Fetch an OIDC token.
  contents: read
  
jobs:

  build:
    runs-on: ubuntu-latest

    steps:
    - name: GIT | Checkout
      uses: actions/checkout@v4

    - name: GIT | Get current branch
      run: echo "CURRENT_BRANCH=${GITHUB_REF#refs/heads/}" >> $GITHUB_ENV

    - name: AZURE | CLI Login
      uses: azure/login@v2
      with:  
        client-id: ${{ secrets.AZURE_CLIENT_ID }}
        tenant-id: ${{ secrets.AZURE_TENANT_ID }}
        subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

    - name: DOCKER | Login, Build and PUSH
      env:
        ACR: atcdevacr.azurecr.io
        ACR_SUFFIX: azurecr.io
        IMG_NAME: connectify-front 
      run: |
        echo "DOCKER | Azure docker login"
        az login
        az acr login --name $ACR

    
        $IMG = $ACR/$IMG_NAME-$env.CURRENT_BRANCH

        echo "DOCKER | Build Image"
        docker build -t $IMG .
        docker push $IMG 

 
